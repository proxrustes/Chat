@using Chat_FrontEnd.ObjectModel
@model UserModel
<style>
body, html {
    height: 100%;
    font-family: Monospace;
    background: white;

}

ul{
  padding-left: 5px;
  margin-top: 0px;
}

.out-wrapper > div{
  color: white;
}


.out-wrapper{
  display: grid;
  height: 100%;
  grid-template-columns: 25% auto;
  color: white;
}

.side-bar {
  display: grid;
  grid-gap: 3px;
  grid-template-rows: auto 150px;
}

.header{
  position: relative;
  display: flex;
  justify-content: space-between;
  width:  100%;
  height:  54px;
  padding: 5px;
  align-items: center;
  background: white;
  font-size: 14px;
  box-shadow: 1px 1px 5px black;
}

.logo{
        color:black;
        font-size:25px;
        text-align:left;
        float:left;
        margin:0px;
        line-height:50px;
        padding-left:9px;
      }


input {
  border: none;
  outline: none;
  border-radius: 3px;
  padding: 0px;
  vertical-align: middle;
  width: calc(100% - 100px);
  height: 40px;
  background: black;
  font-family: monospace;
  color: white;


 text-align: center;
}

#submit {
  margin: 0 auto;
  height: 40px;
  width: 40px;
  left:  -15px;
  padding: 0px;
  border-radius: 8px;
  position: relative;
  vertical-align: middle;
  background: whitesmoke;
  cursor: pointer;
}

#send:before {
  content: "Q";
  font-family: monospace;
  color: black;
  font-size: 20px;
  font-weight: bold;
}

#send:hover{
  background-color: darkgoldenrod;
}


.fa-solid{

  vertical-align: middle;
  padding: 0px;
  border-radius: 8px;
  position: relative;
  cursor: pointer;
}


.dropdown:hover .dropdown-content {
    display: block;
}

.dropdown-content a {
     display: block;
  color: #000000;
  padding: 5px;
  text-decoration: none;
}
.dropdown-content a:hover {
    color: white;
    background-color: darkgoldenrod;
}


.dropdown-content {
  
  display: none;
   right: 0;
  position: absolute;
  background-color: #f9f9f9;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  padding: 2px 2px;

  z-index: 1;
}
.dropdown
{
  height:40px;
  width: 40px;

  display: inline-block;
  vertical-align: middle;
}

.nav-links{
  vertical-align: middle;
  margin-bottom: 0px;
}

.menu-item {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin: 5px;
  }

.left{
  display: flex;
  align-items: center;
}
.right{
  display: flex;
  align-items: center;
}


.left > img
{
  display: inline-block;
  position: relative;
  vertical-align: middle;

  width: 30px;
  height: 30px;
}
.menu-item > a {
  color: red;
  vertical-align: middle;
}

.right > h5 {
    position: relative;
    display: inline;
    vertical-align: middle;
    color: black;
  }

.left > h4 {
    left:5px;
    max-width: 150px;
    overflow: hidden;
    text-overflow: ellipsis;
    vertical-align: middle;
    position: relative;
    display: inline-block;
    color: black;
  }

::selection{
color: darkgoldenrod;
background-color: darkred;
  }


p{
    color:red;
}

</style>
<body>


 <div class="header">
      <h1 class="logo">Hello @Model.userName!</h1>
       <h3 id="chat_name">name</h3>
       <h3 id="chat_id">id</h3>
       <h3 id="pages_count"> </h3>
  </div>

  <div class="out-wrapper">  

  <div class="side-bar" style="background-color:white; margin:5px">
      <div id="all_chats">
            <ul>
             
            </ul>
            </div>

            
                
               

                <div style="display: flex; align-items: center; justify-content: center;">

                 
                   
              </div>
            </div>


<div>
    
   <div id="all_messages"></div>

  </div>
     
</div>

<div>

   
          
<input type="text" id="message_body">
       <button onclick="sendOnClick()">Send</button>
</div>

<p class=@Model.userName id="username" style="display:none"></p>


           <script type="text/javascript">
               

                function sendOnClick(){

                   let chatId = document.getElementById('chat_id');
                   let message_body = document.getElementById('message_body');

                   let xhr = new XMLHttpRequest();
                    xhr.open("POST", "https://localhost:7069/api/messages");

                    xhr.setRequestHeader("Accept", "application/json");
                    xhr.setRequestHeader("Content-Type", "application/json");

                    xhr.onload = () => console.log(xhr.responseText);
                    let username = document.getElementById('username').className;
                    let data = {"chatId": parseInt(chatId.innerText),"userName": username, "messageBody": message_body.value, "deletedForSelf": false, "messageDate":new Date().toJSON()};
                    console.log(JSON.stringify(data));
                    xhr.setRequestHeader("Access-Control-Allow-Origin", "GET, POST, PUT");
                    xhr.send(JSON.stringify(data));
               }


        fetch("https://localhost:7069/api/chats")
        .then(response => 
        {
            return response.json();
        })
        .then(data => 
        {
            const chats = data;
            console.log(chats);
        
           ul =  document.getElementById('all_chats', {mode: 'no-cors'});
           chats.forEach(item => 
            {
            let li = document.createElement('p');
            ul.appendChild(li);
           
            li.innerHTML += item.chatName;
            li.addEventListener('click', function handleClick(event) 
            {
              LoadMessages();
              //LoadPages();
              console.log('chat selected 🎉🎉🎉', li.innerText);
              selected=document.getElementById('chat_name');
              selected.innerHTML = li.innerText;
              selected=document.getElementById('chat_id');
              selected.innerHTML = item.id;

            });
                    }
                );
            });
                   

            function LoadPages()
            {
             var pages_number =  document.getElementById('chat_id');
             fetch("https:localhost:7069/api/messages/pages/?id=" + pages_number.innerText)
            .then(response => 
            {return response.json(); } )
            .then(data_pn => 
            {const pn = data_pn; console.log(pn); 
               ul =  document.getElementById('pages_count'); console.log(ul);
               ul.innerHTML = pn;
               console.log(messages.length)
               
                })
            
            }
           function LoadMessages()
           {
            var number =  document.getElementById('chat_id');
             fetch("https:localhost:7069/api/messages/?id=" + number.innerText)
            .then(response => 
            {return response.json(); } )
            .then(data => 
            {const messages = data; console.log(messages); 
               ul =  document.getElementById('all_messages'); console.log(ul);
               ul.innerHTML='';
               console.log(messages.length)
               for (let i = 0; i < messages.length; i++) 
               {
                var li = document.createElement('p');
                ul.appendChild(li);
                li.innerHTML = messages[i].messageBody + " from " + messages[i].userName + " at " + messages[i].messageDate;
                li.addEventListener('click', function handleClick(event) 
                                        {console.log('page selected 🎉🎉🎉', li.innerText);} );
                }
                })
            
           }

</script>
</body>